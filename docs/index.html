<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>–ú–∞–≥–∞–∑–∏–Ω —É Telegram</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin:0; background:#fff; color:#111; }
    header { padding:16px; font-weight:700; font-size:18px; }
    .wrap { display:flex; gap:20px; padding:16px; align-items:flex-start; }
    .grid { flex:2; display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px; }
    .card { border:1px solid #ddd; border-radius:12px; padding:12px; background:#fff; }
    .card h3 { margin:0 0 8px; font-size:16px; }
    .card .price { margin:6px 0 10px; font-weight:700; }
    .card button { width:100%; padding:8px; border-radius:10px; border:1px solid #999; background:#fff; cursor:pointer; }
    .side { flex:1; min-width:260px; border-left:1px solid #eee; padding-left:16px; position:sticky; top:0; }
    .side h4 { margin:0 0 8px; }
    .item { display:flex; justify-content:space-between; gap:8px; padding:6px 0; border-bottom:1px dashed #eee; }
    .totals { margin-top:8px; font-weight:700; }
    .field { margin:8px 0; display:flex; flex-direction:column; gap:6px; }
    input { padding:10px; border-radius:10px; border:1px solid #ccc; font-size:14px; }
    .btn-primary { width:100%; padding:12px; border:none; border-radius:12px; background:#2a8; color:#fff; font-weight:700; cursor:pointer; }
    .muted { color:#666; font-size:12px; }
    @media (max-width: 860px) { .wrap { flex-direction:column; } .side { border-left:none; padding-left:0; } }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <header>üõç –í—ñ—Ç—Ä–∏–Ω–∞</header>
  <div class="wrap">
    <div class="grid" id="catalog"></div>
    <aside class="side">
      <h4>üß∫ –ö–æ—à–∏–∫</h4>
      <div id="cart"></div>
      <div class="totals" id="totals"></div>
      <div class="field"><label>–ú—ñ—Å—Ç–æ</label><input id="city" placeholder="–ö–∏—ó–≤" /></div>
      <div class="field"><label>–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ù–ü</label><input id="branch" placeholder="–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è ‚Ññ25" /></div>
      <div class="field"><label>–û—Ç—Ä–∏–º—É–≤–∞—á</label><input id="receiver" placeholder="–Ü–≤–∞–Ω –Ü–≤–∞–Ω–æ–≤" /></div>
      <div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input id="phone" placeholder="+380XXXXXXXXX" /></div>
      <button class="btn-primary" id="checkout">‚úÖ –û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
      <div class="muted">–ü—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–µ —É –±–æ—Ç–∞.</div>
    </aside>
  </div>

<script>
  const tg = window.Telegram.WebApp;
  // –†–æ–∑–≥–æ—Ä—Ç–∞—î–º–æ –Ω–∞ –≤—Å—é –≤–∏—Å–æ—Ç—É, –ø—ñ–¥–ª–∞—à—Ç–æ–≤—É—î–º–æ –∫–æ–ª—å–æ—Ä–∏ –ø—ñ–¥ —Ç–µ–º—É Telegram
  tg.expand();
  const theme = tg.themeParams || {};
  document.body.style.background = theme.bg_color || '#fff';
  document.body.style.color = theme.text_color || '#111';

  // –ö–∞—Ç–∞–ª–æ–≥ (SKU –º–∞—é—Ç—å –∑–±—ñ–≥–∞—Ç–∏—Å—è –∑ –±–æ—Ç–æ–º)
  const CATALOG = {
    "coffee_1kg": {title:"–ö–∞–≤–∞ –≤ –∑–µ—Ä–Ω–∞—Ö 1 –∫–≥", price:1299, currency:"UAH"},
    "mug_brand":  {title:"–ë—Ä–µ–Ω–¥–æ–≤–∞ –∫—Ä—É–∂–∫–∞",     price:299,  currency:"UAH"}
  };

  const cart = {}; // {sku: qty}

  function renderCatalog(){
    const grid = document.getElementById('catalog');
    grid.innerHTML = '';
    Object.entries(CATALOG).forEach(([sku, p])=>{
      const el = document.createElement('div');
      el.className = 'card';
      el.innerHTML = \`
        <h3>\${p.title}</h3>
        <div class="price">\${p.price} \${p.currency}</div>
        <button data-sku="\${sku}">–î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫</button>
      \`;
      el.querySelector('button').onclick = ()=> addToCart(sku, 1);
      grid.appendChild(el);
    });
  }

  function addToCart(sku, qty){
    cart[sku] = (cart[sku]||0) + qty;
    renderCart();
  }

  function removeFromCart(sku){
    delete cart[sku];
    renderCart();
  }

  function renderCart(){
    const box = document.getElementById('cart');
    const totals = document.getElementById('totals');
    box.innerHTML = '';
    let total = 0, currency = 'UAH';
    Object.entries(cart).forEach(([sku, qty])=>{
      const p = CATALOG[sku]; if(!p) return;
      total += p.price * qty; currency = p.currency;
      const row = document.createElement('div');
      row.className = 'item';
      row.innerHTML = \`<div>\${p.title} √ó \${qty}</div><div>\${p.price*qty} \${currency} <a href="#" data-rm="\${sku}">‚úñ</a></div>\`;
      row.querySelector('a').onclick = (e)=>{e.preventDefault(); removeFromCart(sku);};
      box.appendChild(row);
    });
    totals.textContent = \`–†–∞–∑–æ–º: \${total} \${currency}\`;
  }

  document.getElementById('checkout').onclick = ()=>{
    const items = Object.entries(cart).map(([sku, qty])=>({sku, qty}));
    if(items.length===0){ alert('–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π'); return; }
    const city = document.getElementById('city').value.trim();
    const branch = document.getElementById('branch').value.trim();
    const receiver = document.getElementById('receiver').value.trim();
    const phone = document.getElementById('phone').value.trim();
    if(!city || !branch || !receiver || !phone){
      alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –º—ñ—Å—Ç–æ, –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è, —ñ–º º—è —Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω');
      return;
    }
    const payload = { type:"checkout", items, city, branch, receiver, phone };
    tg.sendData(JSON.stringify(payload)); // –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —É –±–æ—Ç–∞ —è–∫ web_app_data
    tg.close();
  };

  renderCatalog();
  renderCart();
</script>
</body>
</html>
